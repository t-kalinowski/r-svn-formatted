#
# ${RHOME}/Makefile

VPATH = @srcdir@
srcdir = @srcdir@
top_srcdir = @top_srcdir@

top_builddir = .

include $(top_builddir)/Makeconf

all: R docs

R: stamp-R
stamp-R: $(top_builddir)/src/include/Platform.h
	@echo 'Building R'
	cd src; $(MAKE) R
	@if [ ! -f etc/stamp-docs ]; then\
		echo 'You should'; echo '	make docs'; echo 'now ...';fi
	@touch $@

$(top_builddir)/src/include/Platform.h: $(srcdir)/date-stamp
	$(top_srcdir)/configure --srcdir $(top_srcdir)

docs: build-docs
help: build-help
html: build-html
latex: build-latex
dvi: build-dvi

build-docs build-help build-latex build-html build-dvi::
	-@cd etc; MANSRC=`echo ../src/library/*/man/*.Rd` $(MAKE) $@

install: all installdirs
	$(INSTALL_DATA) R.1 $(mandir)/man1
	$(INSTALL_DATA) Rdconv.1 $(mandir)/man1
	(cd $(mandir)/man1; \
		for f in Rd2txt.1 Rdindex.1 Sd2Rd.1; \
			do rm -f $$f; $(LN_S) Rdconv.1 $$f; \
		done)
	for f in COPYING COPYRIGHTS MIRROR-SITES RESOURCES; \
		do $(INSTALL_DATA) $$f $(rhome); done
	cd afm; $(MAKE) $@
	$(INSTALL_PROGRAM) bin/R.binary $(rhome)/bin
	cat bin/R | sed "s@RHOME=.*@RHOME=$(rhome)@" > $(bindir)/R
	chmod 755 $(bindir)/R
	for f in `ls bin/* | grep -v 'R\|R.binary'`; \
		do $(INSTALL) $$f $(rhome)/bin; done
	cd demos; $(MAKE) $@
	cd doc; $(MAKE) $@
	cd etc; $(MAKE) $@
	for f in include/*.h; \
		do $(INSTALL_DATA) $$f $(rhome)/include; done
	@echo "Installing library ..."
	cd library; tar cf - [a-z]* | (cd $(rhome)/library; tar xf -)
	(cd $(rhome)/library; cat */TITLE > LibIndex 2> /dev/null)
	$(rhome)/etc/build-help --rhome $(rhome) --htmllists

installdirs:
	$(top_srcdir)/aux/mkinstalldirs $(bindir) $(mandir) $(mandir)/man1 \
		$(datadir) $(rhome) $(rhome)/bin \
		$(rhome)/etc $(rhome)/include $(rhome)/library

install-strip:
	$(MAKE) INSTALL_PROGRAM="${INSTALL_PROGRAM} -s" install

uninstall:

mostlyclean:

clean:
	@echo "Cleaning at top level"; rm -f stamp-R
	@cd demos/dynload; $(MAKE) $@
	@echo "Cleaning ./etc/"; cd etc; $(MAKE) $@
	@echo "Cleaning the source tree"; cd src; $(MAKE) $@

acclean:
	@echo "Cleaning configure files"
	@rm -f config.cache config.log config.status \
		Makeconf Makefile Makefrag.f77

moreclean: clean acclean
	@echo "Cleaning ./etc/ a bit more"; cd etc; $(MAKE) $@

distclean: realclean

realclean:
	@echo "Cleaning at top level (+ bin/, library/, cmd/, doc/)"
	@-rm -f bin/R*
	@-rm -rf `echo library/* | sed 's@library/CVS *@@'`
	@-rm -f Makefrag.f77
	@-rm -f cmd/fwf2table
	@-rm -f doc/keyword-test
	@-rm -f doc/manual/lib2tex
	@-rm -f doc/manual/pkg-*
	@-rm -f doc/html/packages* doc/html/function*
	@cd tests; $(MAKE) $@
	@cd demos/dynload; if [ -f Makefile ] ; then $(MAKE) $@ ; fi
	@echo "Really cleaning ./etc/"; cd etc; $(MAKE) $@
	@echo "Really cleaning the source tree"; cd src; $(MAKE) $@
	$(MAKE) acclean

maintainer-clean:

dist:

info:

TAGS:

check: test-Examples

test-All test-Examples::
	-@cd tests; $(MAKE) $@
