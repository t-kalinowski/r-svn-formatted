# @configure_input@
#
# ${R_HOME}/etc/Makeconf-tests

ECHO_C = @ECHO_C@
ECHO_N = @ECHO_N@
ECHO_T = @ECHO_T@

test-src-strict = $(test-src-strict-1) $(test-src-strict-auto)
test-src-sloppy = $(test-src-sloppy-1) $(test-src-sloppy-auto)
test-src-auto = $(test-src-strict-auto) $(test-src-sloppy-auto)
test-src = $(test-src-strict) $(test-src-sloppy)
test-out-strict = $(test-src-strict:.R=.Rout)
test-out-sloppy = $(test-src-sloppy:.R=.Rout)
test-out = $(test-src:.R=.Rout)

R = $(R_HOME)/bin/R --vanilla
RDIFF = $(R_HOME)/bin/Rdiff

.SUFFIXES:
.SUFFIXES: .R .Rin .Rout

.Rin.R: stamp-R
	@echo "creating \`$@'"
	@$(R) < $< > /dev/null

.R.Rout:
	@rm -f $@ $@.fail
	@echo "  Running \`$<'"
	@$(R) < $< > $@
	@if test -f $@.save ; then \
	  mv $@ $@.fail; \
	  echo @ECHO_N@ "  Comparing \`$@' to \`$@.save' ...@ECHO_C@"; \
	  $(RDIFF) $@.fail $@.save $(RVAL_IF_DIFF) || exit 1; \
	  mv $@.fail $@; \
	  echo "@ECHO_T@ OK"; \
	fi

all:
	@(out=`echo "$(test-out-strict)" | sed 's/ //g'`; \
	  if test -n "$${out}"; then \
	    echo " Running strict specific tests"; \
	    $(MAKE) -f $(R_HOME)/etc/Makeconf-tests \
	      "$${out}" RVAL_IF_DIFF=1; \
	  fi)
	@(out=`echo "$(test-out-sloppy)" | sed 's/ //g'`; \
	  if test -n "$${out}"; then \
	    echo " Running sloppy specific tests"; \
	    $(MAKE) -f $(R_HOME)/etc/Makeconf-tests \
	      "$${out}" RVAL_IF_DIFF=0; \
	  fi)

clean:
	@rm -f $(test-out) $(test-src-auto) *.fail
