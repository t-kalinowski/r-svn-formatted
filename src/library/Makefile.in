
#
# ${RHOME}/src/library/Makefile

VPATH = @srcdir@
srcdir = @srcdir@
top_srcdir = @top_srcdir@

top_builddir = ../..

include $(top_builddir)/Makeconf

MANSRC = $(srcdir)/*/man/*.Rd

sed_d = '/^CVS/d; /Makefile/d; /^stamp-/d; /^profile/d;'
sed_db= '/^CVS/d; /Makefile/d; /^stamp-/d; /^profile/d; /^base/d'

all: R

R:
	@$(MKINSTALLDIRS) $(top_builddir)/library
	@cd base; $(MAKE)
	@cd profile; $(MAKE)
	@for pkg in `ls $(srcdir) | sed $(sed_db)`; do \
	  RHOME=`cd $(top_builddir); pwd`; export RHOME; \
	  $(SHELL) $${RHOME}/bin/INSTALL --no-docs $(srcdir)/$${pkg}; \
	done

docs: stamp-docs $(MANSRC) $(top_builddir)/library/LibIndex
help: stamp-help $(MANSRC) $(top_builddir)/library/LibIndex
html: stamp-html $(MANSRC)
latex: stamp-latex $(MANSRC)

stamp-docs:
	@echo "Building ALL documentation (help, HTML, LaTeX)"
	@$(MAKE) DOCS
	@touch $@
	@touch stamp-help
	@touch stamp-html
	@touch stamp-latex
stamp-help:
	@OPTS="--nroff" $(MAKE) DOCS
	@touch $@
stamp-html:
	@OPTS="--html"  $(MAKE) DOCS
	@touch $@
stamp-latex:
	@OPTS="--latex" $(MAKE) DOCS
	@touch $@

$(MANSRC):

$(top_builddir)/library/LibIndex:
	@if [ ! -f $@ ]; then touch $@; fi

DOCS:
	@for pkg in `ls $(srcdir) | sed $(sed_d)`; do \
	  RHOME=`cd $(top_builddir); pwd`; export RHOME; \
	  $${RHOME}/bin/build-help $${OPTS} $(srcdir)/$${pkg}; \
	done

mostlyclean: clean
clean:
	@echo Cleaning in src/library
	@for pkg in `ls $(srcdir) | sed $(sed_db)`; do \
	  if test -d $${pkg}/src; then \
	    (cd $${pkg}/src; rm -f *.o *.so); \
	  fi; \
	done
	@rm -f stamp-*
distclean:
	cd base; $(MAKE) $@
	cd profile; $(MAKE) $@
	@rm -f Makefile
maintainer-clean: distclean

install install-strip uninstall TAGS info dvi check::
