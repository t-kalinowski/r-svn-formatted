<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html> <head>
<title>Notes on RSMethods</title>
<link REL=stylesheet HREF=../../Docs/OmegaTech.css>
</head>

<body>
<h1>Notes on RSMethods</h1>

</h3>Class vs Attribute <code>"class"</code><h3>

In order to dispatch methods based on the class of objects in a
reliable way, the <code>class()</code> function differs from that implied by S4
classes.  This potentially introduces some conflicts with existing
S3-style use of <code>class(x)</code>, to mean <code>attr(x, "class")</code>.

The problem can be avoided by using <code>data.class</code>, which
effectively acts in R like the S4 <code>class</code> function.  Of
course, existing software written according to the green book won't do
this.

The practical alternative would seem to be finding the situations
where redefining <code>class()</code> causes problems, and dealing
with them explicitly.

Name spaces would greatly assist in solving this problem:  In
functions sensitive to the difference in <code>class(x)</code>, we
could specifically use <code>base::class(x)</code>.

The following problems have been found so far:
<ol>
  <li> The <code>as.data.frame</code> function arranges to do
      pseudo-S4-style method dispatch by locally setting the class to
      equal <code>data.class(x)</code> if the class attribute is
      <code>NULL</code>.

      The intended effect is reproduced by having RSMethods override
      <code>as.data.frame</code> with a version that checks and sets
      <code>attr(x, "class")</code> instead of <code>class(x)</code>.<p>
  <li> The default method for the <code>str</code> function explicitly
      checks <code>is.null(class(x))</code> as a test for no
      structure.  We could re-define this method or recognize
      <code>str</code> as an old-style function.
</ol>

<h3>Methods for Primitive Functions</h3>

For the functions that are defined as <code>.Primitive(f)</code>,
there is no function object and, in particular, no formal argument
list.
The current approach is to have in the package a list of what the
generic functions for these <i>would</i> be, but not to install these
as actual functions until a call to <code>setMethod</code> requires
the generic function to exist.

The C implementation of <code>standardGeneric</code> includes code to
evaluate the default methods for these functions (or, for that matter,
any method whose definition is an object of type primitive.
Details, and outstanding issues, with the subset functions as an example, are in <a
href="SubsetMethods.html">SubsetMethods</a>.

<h3>Installation Issues</h3>

The RSMethods package can be installed using either the
<code>--save</code>-style, in which an image is saved at INSTALL time
and loaded later, or in the older <code>--no-save</code>-style.
Either should work, and in the long run the former is definitely
preferable, both because it saves some time when the package is
attached and because it generally computes the objects in the package
in a more standard way (i.e., it plays fewer games with what the user
would ``naturally'' think R is doing).
<p>

<hr>
<address><a href="http://cm.bell-labs.com/cm/ms/departments/sia/jmc/">John Chambers</a><a href=mailto:jmc@research.bell-labs.com>&lt;jmc@research.bell-labs.com&gt;</a></address>
<!-- hhmts start -->
Last modified: Thu Jul 12 18:22:55 EDT 2001
<!-- hhmts end -->
</body> </html>
