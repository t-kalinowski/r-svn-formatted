.First.lib <- function(lib, pkg)
{
    if(!nchar(Sys.getenv("TCL_LIBRARY"))) stop("TCL_LIBRARY is not set")
    library.dynam("TclTk", pkg, lib)
    .C("tcltk_start", PACKAGE="TclTk")
    extra <- system.file("exec", package = "tcltk")
    extra <- gsub("\\\\", "/", extra)
    invisible(addTclPath(extra))
}

.Last.lib <- function(libpath) {
    if(is.loaded(symbol.C("tcltk_end"))) {
        .C("tcltk_end", PACKAGE="TclTk")
        dyn.unload(file.path(libpath, "libs", "TclTk.dll"))
        num <- match("TclTk", .Dyn.libs)
        assign(".Dyn.libs", .Dyn.libs[-num], envir=.AutoloadEnv)
    }
}
