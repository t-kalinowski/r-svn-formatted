#
# ${R_HOME}/src/main/Makefile

VPATH = @srcdir@
srcdir = @srcdir@
top_srcdir = @top_srcdir@

top_builddir = ../..
subdir = src/main

include $(top_builddir)/Makeconf

SOURCES_C = \
	@LIBOBJS@ \
	apply.c \
	arithmetic.c \
	array.c \
	attrib.c \
	bind.c \
	builtin.c \
	character.c \
	coerce.c \
	colors.c \
	complex.c \
	context.c \
	cov.c \
	cum.c \
	datetime.c \
	debug.c \
	devPS.c \
	devPicTeX.c \
	deparse.c \
	deriv.c \
	devices.c \
	dotcode.c \
	dstruct.c \
	duplicate.c \
	envir.c \
	errors.c \
	eval.c \
	format.c \
	fourier.c \
	g_her_glyph.c \
	g_fontdb.c \
	g_cntrlify.c \
	g_alab_her.c \
	gram.c \
	gram-ex.c \
	graphics.c \
	iosupport.c \
	list.c \
	logic.c \
	main.c \
	match.c \
	memory.c \
	model.c \
	names.c \
	objects.c \
	optim.c \
	optimize.c \
	options.c \
	par.c \
	paste.c \
	platform.c \
	plot.c \
	plot3d.c \
	plotmath.c \
	print.c \
	printarray.c \
	printvector.c \
	printutils.c \
	random.c \
	RNG.c \
	regex.c \
	relop.c \
	saveload.c \
	scan.c \
	seq.c \
	size.c \
	sort.c \
	source.c \
	split.c \
	subassign.c \
	subscript.c \
	subset.c \
	summary.c \
	unique.c \
	util.c \
	version.c
SOURCES_F = \
	xxxpr.f
DEPENDS = $(SOURCES_C:.c=.d)
OBJECTS = $(SOURCES_C:.c=.o) $(SOURCES_F:.f=.o)
HEADERS = \
	arithmetic.h \
	g_cntrlify.h \
	g_control.h \
	g_extern.h \
	g_her_metr.h \
	g_jis.h \
	names.h \
	regex.h \
	Rstrptime.h

distdir = $(top_builddir)/$(PACKAGE)-$(VERSION)/$(subdir)
DISTFILES = Makefile.in Makefile.win \
	$(HEADERS) \
	$(SOURCES_C) \
	strdup.c \
	$(SOURCES_F) \
	gram.y

RLIBS = ../unix/libunix.a ../appl/libappl.a ../nmath/libmath.a

ALL_LIBS = $(RLIBS) $(LIBS) $(BLAS_LIBS) $(FLIBS) $(R_XTRA_LIBS)

Rexeclib_LTLIBRARIES = libR.la
libR_la_SOURCES = $(SOURCES)
libR_la_LDFLAGS = 
libR_la_OBJECTS = $(OBJECTS:.o=.lo)
libR_la_LIBADD = 
libR_la_DEPENDENCIES = ../appl/stamp-lo ../nmath/stamp-lo ../unix/stamp-lo

all: Makefile Makedeps R

Makefile: $(srcdir)/Makefile.in \
  $(top_builddir)/config.status \
  ../include/config.h \
  ../include/Rversion.h \
  $(SOURCES_C)
	@cd $(top_builddir) && \
	  CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= \
	  $(SHELL) ./config.status

Makedeps: Makefile $(DEPENDS)
	@cat $(DEPENDS) >> Makefile
	@touch $@

R: Makefile
	@$(MAKE) Makedeps
	@$(MAKE) $(top_builddir)/bin/R.bin
	@@WANT_SHLIB_TRUE@$(MAKE) libR.la
	@(cd ../unix && $(MAKE) DLLs)

../include/config.h ../include/Rversion.h:
	(cd $(@D); $(MAKE) $(@F))

$(top_builddir)/bin/R.bin: $(OBJECTS) $(RLIBS) @EXPORTFILE@
	@$(MKINSTALLDIRS) $(top_builddir)/bin
	$(MAIN_LD) $(MAIN_LDFLAGS) $(LDFLAGS) -o $@ $(OBJECTS) $(ALL_LIBS)

$(top_builddir)/etc/R.exp: $(OBJECTS) $(RLIBS)
	@$(top_srcdir)/tools/ldAIX4 -o $@ $(OBJECTS) $(RLIBS)

$(RLIBS):
	(cd $(@D); $(MAKE) $(@F))

libR.la: $(libR_la_OBJECTS) $(libR_la_DEPENDENCIES)
	$(LTLINK) -rpath $(Rexeclibdir) -avoid-version -o $@ $(libR_la_OBJECTS) `ls ../appl/*.lo ../nmath/*.lo ../unix/*.lo` $(LIBS) $(BLAS_LIBS) $(FLIBS) $(R_XTRA_LIBS)
## FIXME
	@$(MAKE) rhome=`cd $(top_builddir); pwd` install

$(libR_la_DEPENDENCIES):
	(cd $(@D); $(MAKE) $(@F))

gram.c: $(srcdir)/gram.y
	$(YACC) $(YFLAGS) $(srcdir)/gram.y
	$(top_srcdir)/tools/move-if-change y.tab.c $(@F)

install: installdirs
@USE_LIBTOOL_FALSE@	@$(top_srcdir)/tools/copy-if-change libR.la $(Rexeclibdir)/libR.$(SHLIB_EXT)
@USE_LIBTOOL_TRUE@	@$(LIBTOOL) --mode=install $(INSTALL) libR.la $(Rexeclibdir)
installdirs:
	@$(MKINSTALLDIRS) $(Rexeclibdir)

mostlyclean: clean
clean:
	@-rm -rf .libs _libs
	@-rm -f *core Makedeps *.d *.o *.lo *.la
distclean: clean
	@-rm -f Makefile
maintainer-clean: distclean
	@echo "This command is intended for maintainers to use; it"
	@echo "deletes files that may need special rules to rebuild"
	@rm -f gram.c

tags: *.h *.c
	ctags *.h *.c
TAGS: *.h *.c
	etags *.h *.c

distdir: $(DISTFILES)
	@for f in $(DISTFILES); do \
	  test -f $(distdir)/$${f} \
	    || ln $(srcdir)/$${f} $(distdir)/$${f} 2>/dev/null \
	    || cp -p $(srcdir)/$${f} $(distdir)/$${f}; \
	done

# Unused targets

install-strip uninstall info dvi check::

## Automagically generated dependencies:

