#!/bin/sh
# Shell installer for RAqua
# RAqua is a bundle app that contains the R.bin bundle app
# ${R_HOME}/src/modules/aqua/AquaInstall

top_builddir=../../..
srcdir=@srcdir@
subdir=src/modules/aqua
top_srcdir=@top_srcdir@



here=`pwd`;
cp ${top_srcdir}/src/modules/aqua/R.fix /Applications/StartR.app/RAqua.app/Contents/
cd /Applications/StartR.app/RAqua.app/Contents
if !(test -f R_RESOURCES);  then 
 mv RESOURCES R_RESOURCES 
fi
if !(test -e MacOS); then
 mv bin MacOS
 ln -s MacOS bin
fi 
if !(test -f MacOS/RAqua); then
  cd MacOS
  mv R.bin RAqua
  ln -s RAqua R.bin
  cd ..
fi
sh R.fix
rm R.fix
cd ${here}
cd ${top_srcdir}
cp -R src/modules/aqua/Contents/Resources /Applications/StartR.app/RAqua.app/Contents
cp src/modules/aqua/Contents/PkgInfo /Applications/StartR.app/RAqua.app/Contents
cp src/modules/aqua/Contents/Info.plist /Applications/StartR.app/RAqua.app/Contents

mkdir -p /Applications/StartR.app/Contents
mkdir -p /Applications/StartR.app/Contents/Resources
cp src/modules/aqua/RAqua/Contents/Resources/RAqua.icns \
    /Applications/StartR.app/Contents/Resources/
cp src/modules/aqua/RAqua/Contents/PkgInfo /Applications/StartR.app/Contents/
cp src/modules/aqua/RAqua/Contents/Info.plist /Applications/StartR.app/Contents/
# move libR.dylib inside Frameworks
mkdir -p /Applications/StartR.app/RAqua.app/Contents/Frameworks
if test /Applications/StartR.app/RAqua.app/Contents/MacOS/libR.dylib; then
 mv /Applications/StartR.app/RAqua.app/Contents/MacOS/libR.dylib \
   /Applications/StartR.app/RAqua.app/Contents/Frameworks/
fi

cd ${here}
cd ${top_builddir}/${subdir}/
# builds the StartR exec code
if !(test -f a.out); then
 make aqualaunch
fi
mkdir -p /Applications/StartR.app/Contents/MacOS
cp a.out /Applications/StartR.app/Contents/MacOS/StartR

# echo "Note: execute this script one time only!"

