#!/bin/sh
# Shell installer for RAqua
# RAqua is a bundle app that contains the R.bin bundle app
# ${R_HOME}/src/modules/aqua/AquaInstall

top_builddir=../../..
srcdir=@srcdir@
subdir=src/modules/aqua
top_srcdir=@top_srcdir@



here=`pwd`;
cd ${top_builddir}

make install rhome=/Applications/StartR.app/RAqua.app/Contents mandir=/Applications/StartR.app/RAqua.app/Contents bindir=/Applications/StartR.app/RAqua.app/Contents

cd ${here}
cp ${top_srcdir}/src/modules/aqua/R.fix /Applications/StartR.app/RAqua.app/Contents/
cd /Applications/StartR.app/RAqua.app/Contents
mv RESOURCES R_RESOURCES
mv bin MacOS
ln -s MacOS bin
cd MacOS
mv R.bin RAqua
ln -s RAqua R.bin
cd .. 
./R.fix
rm R.fix
cd ${here}
cd ${top_srcdir}
cp -R src/modules/aqua/Contents/Resources /Applications/StartR.app/RAqua.app/Contents
cp src/modules/aqua/Contents/PkgInfo /Applications/StartR.app/RAqua.app/Contents
cp src/modules/aqua/Contents/Info.plist /Applications/StartR.app/RAqua.app/Contents

mkdir -p /Applications/StartR.app/Contents
mkdir -p /Applications/StartR.app/Contents/Resources
cp src/modules/aqua/RAqua/Contents/Resources/RAqua.icns /Applications/StartR.app/Contents/Resources/
cp src/modules/aqua/RAqua/Contents/PkgInfo /Applications/StartR.app/Contents/
cp src/modules/aqua/RAqua/Contents/Info.plist /Applications/StartR.app/Contents/
cp src/modules/aqua/RAqua/Contents/MacOS/aqualaunch.c ${here}/

cd ${here}
cd ${top_builddir}/${subdir}/
# builds the StartR exec code
gcc aqualaunch.c
mkdir -p /Applications/StartR.app/Contents/MacOS
mv a.out /Applications/StartR.app/Contents/MacOS/StartR
# Modifies Rprofile according to AQUA needs
cat  /Applications/StartR.app/RAqua.app/Contents/library/base/R/Rprofile ${top_srcdir}/${subdir}/aqua.R > Rprofile
mv Rprofile /Applications/StartR.app/RAqua.app/Contents/library/base/R/
echo "Note: execute this script one time only!"

