#
# ${RHOME}/tests/Makefile

VPATH = @srcdir@
srcdir = @srcdir@
top_srcdir = @top_srcdir@

top_builddir = ..
subdir = tests

include $(top_builddir)/Makeconf

distdir = $(top_builddir)/$(PACKAGE)-$(VERSION)/$(subdir)
DISTFILES = $(shell cd $(srcdir); \
	       ls Makefile.in README Rdiff *.R *.Rout.save)
SUBDIRS = Examples

## FIXME

## Makefile  for  <RHOME>/tests/		-- Martin Maechler
##
RHOME= ..
R    = $(RHOME)/bin/R --no-init-file --no-save --no-restore
Rbinary = $(rRHOME)/bin/R.binary
Rbase	= $(rRHOME)/library/base
REXE = $(Rbinary) $(Rbase)

Ex = ./Examples

TESTsrc = simple-true.R simple-tests.R d-p-q-r-tests.R \
	 print-tests.R is-things.R primitive-funs.R

TESTout = $(TESTsrc:.R=.Rout)

%.Rout: %.R $(top_builddir)/stamp-R
	@(SRCDIR=$(srcdir); export SRCDIR; \
	  echo "$(R) < $< > $@"; \
	  $(R) < $< > $@)
	$(srcdir)/Rdiff $@ $(srcdir)/$@.save

test-All: test-Examples $(TESTout)

test-Examples:
	-(cd $(Ex); $(MAKE) $@)

$(top_builddir)/stamp-R:
	-(cd $(top_builddir) && $(MAKE) R)

mostlyclean: clean
clean:
	-(cd $(Ex); $(MAKE) $@)
distclean: clean
	@rm -f $(TESTout)
	-(cd $(Ex); $(MAKE) $@)
	@rm -f Makefile
maintainer-clean: distclean

distdir: $(DISTFILES)
	@for f in $(DISTFILES); do \
	  test -f $(distdir)/$${f} \
	    || ln $(srcdir)/$${f} $(distdir)/$${f} 2>/dev/null \
	    || cp -p $(srcdir)/$${f} $(distdir)/$${f}; \
        done
	@for d in $(SUBDIRS); do \
	  test -d $(distdir)/$${d} \
	    || mkdir $(distdir)/$${d} \
	    || exit 1; \
	  chmod 755 $(distdir)/$${d}; \
	  (cd $${d} && $(MAKE) distdir) \
	    || exit 1; \
        done
